#!/bin/sh
#
# AndroidExsample configure script
#
# Copyright (c) 2018 成都东方盛行电子有限责任公司
#

# 当前脚本目录
CURRENT_PATH=$(cd "$(dirname "$0")";pwd)

source ${CURRENT_PATH}/../../../../script/pub.sh

# 显示帮助信息
show_help() {
    cat <<EOF
Usage: configure [options]
Options:
-h|--help                               print this message
--libav-inc-dir=LIBAV_INC_DIR           libav include directory
--libav-lib-dir=LIBAV_LIB_DIR           libav lib directory
--xedit-inc-dir=XEDIT_INC_DIR           xedit include directory
--xedit-lib-dir=XEDIT_LIB_DIR           xedit lib directory
--xedit-gen-dir=XEDIT_GEN_DIR           xedit generated directory
--nle-lib-dir=NLE_LIB_DIR               nlengine lib directory
--vs-version=VS_VERSION                 set visual studio version, such as: 2010, 2015, 2017
EOF
    exit 0
}

# 解析参数
for var in "$@"; do
    value=${var#*=}
    name=${var%"$value"}
    if test -z ${name}; then
        name=${value}
    else
        value=$(sh_quote "$value")
    fi

    case ${name} in
        -h|--help)
            show_help
            ;;
        --libav-inc-dir=)
            LIBAV_INC_DIR=${value}
            ;;
        --libav-lib-dir=)
            LIBAV_LIB_DIR=${value}
            ;;
        --xedit-inc-dir=)
            XEDIT_INC_DIR=${value}
            ;;
        --xedit-lib-dir=)
            XEDIT_LIB_DIR=${value}
            ;;
        --xedit-gen-dir=)
            XEDIT_GEN_DIR=${value}
            ;;
        --nle-lib-dir=)
            NLE_LIB_DIR=${value}
            ;;
        --vs-version=)
            VS_VERSION=${value}
            ;;
        *)
            OPTIONS="${OPTIONS} ${var}"
            ;;
    esac
done

if [ -z "${LIBAV_INC_DIR}" ]; then
    echo "libav include directory not set! See -h option"
    die
fi
if [ -z "${LIBAV_LIB_DIR}" ]; then
    echo "libav lib directory not set! See -h option"
    die
fi

if [ -z "${XEDIT_INC_DIR}" ]; then
    echo "xedit include directory not set! See -h option"
    die
fi
if [ -z "${XEDIT_LIB_DIR}" ]; then
    echo "xedit lib directory not set! See -h option"
    die
fi

if [ -z "${NLE_LIB_DIR}" ]; then
    echo "nlengine lib directory not set! See -h option"
    die
fi

# 写入cmake配置文件
CMAKE_CONFIG_FILE=${CURRENT_PATH}/config.cmake
cat > ${CMAKE_CONFIG_FILE} <<EOF
# Automatically generated by configure - do NOT modify!
set(LIBAV_INC_DIR ${LIBAV_INC_DIR})
set(LIBAV_LIB_DIR ${LIBAV_LIB_DIR})
set(XEDIT_INC_DIR ${XEDIT_INC_DIR})
set(XEDIT_LIB_DIR ${XEDIT_LIB_DIR})
set(XEDIT_GEN_DIR ${XEDIT_GEN_DIR})
set(NLE_LIB_DIR ${NLE_LIB_DIR})
EOF

# 写入properties配置文件
GRADLE_PROPERTIES_FILE=${CURRENT_PATH}/config.properties
cat > ${GRADLE_PROPERTIES_FILE} <<EOF
# Automatically generated by configure - do NOT modify!
LIBAV_INC_DIR = ${LIBAV_INC_DIR}
LIBAV_LIB_DIR = ${LIBAV_LIB_DIR}
XEDIT_INC_DIR = ${XEDIT_INC_DIR}
XEDIT_LIB_DIR = ${XEDIT_LIB_DIR}
XEDIT_GEN_DIR = ${XEDIT_GEN_DIR}
NLE_LIB_DIR   = ${NLE_LIB_DIR}
EOF